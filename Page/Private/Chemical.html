<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../Style/Main.css">
    <title>Chemical!</title>
    <script>
        function Atom(num, sym, kor, eng){
            this.number = num;
            this.symbol = sym;
            this.korean = kor;
            this.english = eng;
        }

        function fillArray(json){
            var len = json.Chemical.length;
            count = len;
            for (let i = 1; i <= len; i++){
                var atom = json.Chemical[i-1];
                arr[i] = new Atom(atom.number, atom.symbol, atom.korean, atom.english);
            }
        }

        var arr = new Array(150);
        var request = new XMLHttpRequest();
        var url = "https://leonld94.github.io/University_File/Chemical.json";
        var count = -1;
        request.open('Get', url);
        request.responseType = 'json';
        request.send();
        request.onload = function(){
            fillArray(request.response);
        }
        
        function Generate(){
            var input = document.getElementById('sentence').value;
            var len = input.length;
            var result = validate(input);
            document.getElementById('english').innerHTML = "";
            document.getElementById('korean').innerHTML = "";
            document.getElementById('number').innerHTML = "";
            if (result == "-1"){
                alert("Non-English Character Detected.");
                return;
            }
            var found = find(new Array(), result, 0);
            if (found == false) alert("Nothing Found!");
        }

        function find(res, str, ptr){
            var len = str.length;
            if (len-ptr == 0){
                var symbol = document.getElementById('symbol');
                var english = document.getElementById('english');
                var korean = document.getElementById('korean');
                var number = document.getElementById('number');
                var l = res.length;
                for (let i = 0; i < l; i++){
                    symbol.innerHTML += arr[ res[i] ].english + " ";
                    english.innerHTML += arr[ res[i] ].english + " ";
                    korean.innerHTML += arr[ res[i] ].korean + " ";
                    number.innerHTML += arr[ res[i] ].number + " ";
                }
                symbol.innerHTML += "<br>";
                english.innerHTML += "<br>";
                korean.innerHTML += "<br>";
                number.innerHTML += "<br>";
                return true;
            }
            var found = false;
            for (let i = 1; i <= count; i++){
                var atom = arr[i].symbol;
                var alen = atom.length;

                if (len-ptr < alen) continue;

                if (alen == 1){
                    var a1 = atom.charCodeAt(0);
                    var s1 = str.charCodeAt(ptr);
                    a1 += 32;

                    if (a1 == s1){
                        res.push(i);
                        console.log(res, i);
                        if (find(res, str, ptr+1) == true) found = true;
                        res.pop();
                    }
                }
                if (alen == 2){
                    var a1 = atom.charCodeAt(0), a2 = atom.charCodeAt(1);
                    var s1 = str.charCodeAt(ptr), s2 = str.charCodeAt(ptr+1);
                    a1 += 32;

                    if (a1 == s1 && a2 == s2){
                        res.push(i);
                        console.log(res, i);
                        if (find(res, str, ptr+2) == true) found = true;
                        res.pop();
                    }
                }
            }
            return found;
        }

        function validate(string){
            var len = string.length;
            var result = "";
            var valid = true;
            for (let i = 0; i < len; i++){
                var char = string.charCodeAt(i);
                if (65 <= char && char <= 90) char += 32;
                if (97 <= char && char <= 122) result += String.fromCharCode(char);
                else if (char == 32) continue;
                else valid = false;
            }
            if (valid == false) return "-1";
            else return result;
        }
    </script>
</head>
<body>
    <header>
        <div id="title" onclick="location.href='../Private.html'">
            <div id="title_text">Chemical Sentence</div>
        </div>
    </header>
    <section id="body">
        <div id="body-flex" style="width: 100%">
            <div id="input">
                <h2>문장을 입력하세요. (영어만 가능합니다.) : </h2>
                <input id="sentence" type="text" style="width: 80%"> <button onclick="Generate()">Generate!</button><br>
            </div>
            <div>
                <h2>결과 (기호) : </h2>
                <div id="symbol"></div>
            </div>
            <div>
                <h2>결과 (영어) : </h2>
                <div id="english"></div>
            </div>
            <div>
                <h2>결과 (한글) : </h2>
                <div id="korean"></div>
            </div>
            <div>
                <h2>결과 (원자번호) : </h2>
                <div id="number"></div>
            </div>
        </div>
    </section>
</body>
</html>