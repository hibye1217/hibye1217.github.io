<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../Style/Main.css">
    <title>Score!</title>
    <style>
        .rank{
            width: 10%;
        }
        .team{
            width: 30%;
        }
        .name{
            width: 30%;
        }
        .score{
            width: 30%;
        }
    </style>
    <script>
        function RequestFailed(){
            alert("Request Failed.");
        }

        var Name = new Array(1020), count = 0;
        var Score = new Array(1020);
        var Rank = new Array(1020);
        var Team = new Array(1020);
        var TeamName = new Array(1020), teamCount = 0;
        TeamName[0] = "No Team";

        function Sort(){
            for (let i = 1; i <= count; i++) Rank[i] = i;

            for (let i = 1; i <= count; i++){
                for (let j = 1; j <= count-i; j++){
                    if (Score[ Rank[j] ] < Score[ Rank[j+1] ]){
                        var tmp = Rank[j];
                        Rank[j] = Rank[j+1];
                        Rank[j+1] = tmp;
                    }
                }
            }
        }

        function Print(){
            Sort();

            var scoreboard = document.getElementById('scoreboard');
            while (scoreboard.childElementCount != 0) scoreboard.removeChild(scoreboard.childNodes[0]);
            for (let j = 1; j <= count; j++){
                var tr = document.createElement('tr');
                var rank, team, name, score;
                let i = Rank[j];

                rank = document.createElement('td');
                rank.className = "rank";
                rank.innerHTML = j;
                if (j%10 == 1 && j%100 != 11) rank.innerHTML += "st";
                else if (j%10 == 2 && j%100 != 12) rank.innerHTML += "nd";
                else if (j%10 == 3 && j%100 != 13) rank.innerHTML += "rd";
                else rank.innerHTML += "th";
                tr.appendChild(rank);

                team = document.createElement('td');
                team.className = "team";
                team.innerHTML = TeamName[ Team[i] ];
                tr.appendChild(team);

                name = document.createElement('td');
                name.className = "name";
                name.innerHTML = Name[i];
                tr.appendChild(name);

                score = document.createElement('td');
                score.className = "score";
                score.innerHTML = Score[i];
                tr.appendChild(score);

                scoreboard.appendChild(tr);
            }
        }

        function AddPlayer(){
            var input = prompt("Name?");
            if (input == null || input.length == 0){
                RequestFailed();
                return;
            }
            for (let i = 1; i <= count; i++){
                if (Name[i] == input){
                    RequestFailed();
                    return;
                }
            }

            count += 1;
            Name[count] = input;
            Team[count] = 0;
            Score[count] = 0;

            Print();
        }

        function AddScore(){
            var input = prompt("Name?");
            if (input == null || input.length == 0){
                RequestFailed();
                return;
            }
            var idx = -1;
            for (let i = 1; i <= count; i++){
                if (input == Name[i]) idx = i;
            }
            if (idx == -1){
                RequestFailed();
                return;
            }
            
            input = prompt("Add?");
            if (input == null || input.length == 0 || isNaN(input)){
                RequestFailed();
                return;
            }
            Score[idx] += parseInt(input);

            Print();
        }

        function Save(){
            var string = "";
            string += "function Manual(){\n";

            string += "  teamCount = " + teamCount + ";\n";
            for (let i = 1; i <= teamCount; i++){
                string += "  TeamName[" + i + "] = \"" + TeamName[i] + "\";\n";
            }

            string += "  count = " + count + ";\n";
            for (let i = 1; i <= count; i++){
                string += "  Name[" + i + "] = \"" + Name[i] + "\";\n";
                string += "  Score[" + i + "] = " + Score[i] + ";\n";
                string += "  Team[" + i + "] = " + Team[i] + ";\n";
            }

            string += "  Print();\n";
            string += "}\n";

            string += "Manual();";

            console.log(string);
        }
    </script>
</head>
<body>
    <header>
        <div id="title" onclick="location.href='../Private.html'">
            <div id="title_text">Special Function</div>
        </div>
    </header>
    <section id="body">
        <div id="body-flex" style="width: 100%">
            <div id="result">
                <h2>Scoreboard</h2>
                <table style="width:90%;position:relative;left:5%">
                    <thead>
                        <tr>
                            <th class="rank">Rank</th>
                            <th class="team">Team</th>
                            <th class="name">Name</th>
                            <th class="score">Score</th>
                        </tr>
                    </thead>
                    <tbody id="scoreboard">

                    </tbody>
                </table>
            </div>
            <div id="input">
                <button onclick="AddPlayer()">Add Player</button>
                <button onclick="AddScore()">Add Score</button>
                <button onclick="Save()" title="F12">Save</button>
            </div>
        </div>
    </section>
</body>
</html>